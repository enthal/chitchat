<script src='http://coffeescript.org/extras/coffee-script.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/angularjs/1.2.9/angular.js'></script>
<script src='https://s3-us-west-2.amazonaws.com/change-ds-tj/socket.io/socket.io.js'></script>

<script src='client.coffee' type='text/coffeescript'></script>

<body ng-app='chitchat'>

  <h1>chitchat</h1>

  <div ng-controller='ChitChat' ng-cloak>

    <div ng-if=" isConnected">:-) connected</div>
    <div ng-if="!isConnected">:-( disconnected</div>

    <form ng-submit="makeNewRoom()">
      room:
      <select ng-model="roomName" ng-options="x for x in getRoomNames()">
        <option value="">-- new --</option>
      </select>
      <input type="text" ng-model="newRoomNameText" placeholder="room name" ng-show="!roomName">
    </form>

    <div ng-show="roomName">
      <form ng-submit="sendMessage()">
        <input type="text" ng-model="messageText" placeholder="your message">
        <input type="submit" value="send" ng-disabled="!messageText">
      </form>

      <div>
        <ng-pluralize count="getMessagesInSelectedRoom().length"
              when="{ '0':     'The room is empty',
                      'one':   '1 message',
                      'other': '{} messages'    }">
        </ng-pluralize>
        <ul>
          <li ng-repeat='message in getMessagesInSelectedRoom()'>{{message.body}}</li>
        </ul>
      </div>
    </div>

  </div>

</body>


<!-- allow coffeescript to convert before angular bootstraps -->
<script type='text/coffeescript'> angular.resumeBootstrap() </script>
<script> window.name = 'NG_DEFER_BOOTSTRAP!'</script>
